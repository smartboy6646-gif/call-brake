<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Ronnie Payroll Ultimate v2.1</title>
<style>
:root { --primary: #2962ff; --bg: #f0f4f8; --card-bg: #ffffff; --text: #333; --red: #ff5252; --green: #4caf50; }
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);}
.container{max-width:420px;margin:auto;padding:12px;}
h2{text-align:center;color:var(--primary);margin-bottom:2px;font-size: 24px;}
.card{background:var(--card-bg);padding:16px;border-radius:16px;margin-bottom:12px;box-shadow:0 8px 20px rgba(0,0,0,.05);}
label{font-size:12px;color:var(--primary);font-weight:bold;display:block;margin-bottom:4px;text-transform:uppercase;}
select,button,input{width:100%;padding:12px;font-size:16px;border-radius:10px;border:1.5px solid #d1d9e6;margin-bottom:12px;box-sizing:border-box;outline:none;}
input:focus, select:focus{border-color:var(--primary);}
button{background:var(--primary);color:#fff;border:none;cursor:pointer;font-weight:bold;transition:0.3s;}
button:active{transform:scale(0.96);}

/* Table & Stats */
table{width:100%;border-collapse:collapse;font-size:12px;margin-bottom:10px;}
th{color:#90a4ae;text-align:center;border-bottom:1px solid #eee;padding-bottom:8px;}
td{padding:12px 4px;border-bottom:1px solid #f9f9f9;text-align:center;}
.row-weekend{background-color: #fff5f5;}
.badge-day{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:bold;color:#fff;}

/* Dark Report Card */
.report-card{background:#0a192f;color:#fff;padding:20px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
.report-title{font-size:18px;font-weight:bold;margin-bottom:15px;color:var(--green);border-bottom:1px solid #1e2d4d;padding-bottom:8px;}
.report-line{display:flex;justify-content:space-between;font-size:14px;margin-bottom:10px;color:#cbd5e0;}
.report-val{font-weight:bold;color:#fff;font-family:monospace;}

.salary-box{background:#112240;padding:15px;border-radius:12px;margin-top:15px;text-align:center;border:1px solid var(--primary);}
.total-amt{font-size:28px;color:var(--green);font-weight:bold;margin:12px 0;}
.green-btn{background:var(--green);margin-top:8px;}
.red-btn{background:var(--red);margin-top:12px;padding:10px;font-size:13px;}
.hide{display:none;}
</style>
</head>
<body>

<div class="container">
    <h2>Ronnie Ruchal</h2>
    <p style="text-align:center;margin-top:-6px;font-size:12px;color:#777;">Ultimate Payroll Tracker ‚Ä¢ v2.1.0</p>

    <div class="card">
        <label>Select Date</label>
        <input type="date" id="inputDate" onchange="autoDetectDay()">

        <label>Day Type</label>
        <select id="dayType" onchange="updateUI()">
            <option value="weekday">Weekday (Mon-Fri)</option>
            <option value="saturday">Saturday</option>
            <option value="sunday">Sunday</option>
            <option value="holiday">Public Holiday</option>
        </select>

        <div id="workedBox" class="hide">
            <label>Worked Today?</label>
            <select id="worked" onchange="updateUI()">
                <option value="yes">Yes (‡§ï‡§æ‡§Æ ‡§ó‡§∞‡•á‡§ï‡•ã)</option>
                <option value="no">No (‡§¨‡§ø‡§¶‡§æ ‡§¨‡§∏‡•á‡§ï‡•ã)</option>
            </select>
        </div>

        <div id="outBox">
            <label>Out Time (Exit)</label>
            <select id="outTime"></select>
        </div>

        <button onclick="saveEntry()" style="font-size:18px;">Save Entry üíæ</button>
    </div>

    <div class="card" style="padding:10px;">
        <table>
            <thead>
                <tr><th>Date</th><th>Day</th><th>Basic</th><th>OT</th><th>Action</th></tr>
            </thead>
            <tbody id="historyBody"></tbody>
        </table>

        <div class="report-card">
            <div class="report-title">Monthly Analytics</div>
            <div class="report-line"><span>üìÖ Weekday Basic:</span><span class="report-val" id="totalBasicHrs">0</span></div>
            <div class="report-line"><span>üóìÔ∏è Saturday Worked:</span><span class="report-val" id="satStats">0 days</span></div>
            <div class="report-line"><span>‚òÄÔ∏è Sunday Worked:</span><span class="report-val" id="sunStats">0 days</span></div>
            <div class="report-line"><span>üéà Public Holiday:</span><span class="report-val" id="holStats">0 days</span></div>
            <div class="report-line"><span>‚öôÔ∏è Normal OT (1.5x):</span><span class="report-val" id="totalNormalOt">0.00</span></div>
            <div class="report-line"><span>üåô Night OT (3.0x):</span><span class="report-val" id="totalNightOt">0.00</span></div>
            
            <div class="salary-box">
                <label style="color:#94a3b8">Hourly Rate (‚Ç©)</label>
                <input type="number" id="hourlyRate" value="11500" style="margin-bottom:10px;text-align:center;color:var(--green);font-size:20px;font-weight:bold;background:transparent;border:none;border-bottom:1px solid #2962ff;">
                <button onclick="calculateSalary()">Refresh Salary</button>
                <div class="total-amt">‚Ç© <span id="finalSalary">0</span></div>
                <button class="green-btn" onclick="exportToExcel()">üì• Download Excel Report</button>
                <button class="red-btn" onclick="resetAll()">‚ö†Ô∏è Reset All Data</button>
            </div>
        </div>
    </div>
</div>

<script>
const STORE_KEY="ronnie_ultimate_v2.1";
let entries=JSON.parse(localStorage.getItem(STORE_KEY)||"[]");

const weekdayTimes=["5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM","9:30 PM","10:00 PM","10:30 PM","11:00 PM","11:30 PM","12:00 AM"];
const weekendTimes=["5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM"];

function timeToMins(t) {
    if(!t) return 1050; 
    let [time, mod] = t.split(' ');
    let [h, m] = time.split(':');
    h = parseInt(h);
    if (h === 12) h = (mod === 'AM') ? 0 : 12;
    else if (mod === 'PM') h += 12;
    let mins = (h * 60) + parseInt(m);
    return (mins === 0) ? 1440 : mins;
}

function setInitialDate() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('inputDate').value = today;
    autoDetectDay();
}

function autoDetectDay() {
    let dateVal = document.getElementById("inputDate").value;
    if(!dateVal) return;
    let d = new Date(dateVal);
    let dayNum = d.getDay(); 
    let daySelect = document.getElementById("dayType");
    if(dayNum === 0) daySelect.value = "sunday";
    else if(dayNum === 6) daySelect.value = "saturday";
    else daySelect.value = "weekday";
    updateUI();
}

function updateUI(){
    let day=document.getElementById("dayType").value;
    let worked=document.getElementById("worked").value;
    let out=document.getElementById("outTime");
    out.innerHTML="";
    let currentTimes = (day === "weekday") ? weekdayTimes : weekendTimes;
    currentTimes.forEach(t=>{ let o=document.createElement("option"); o.value=t; o.text=t; out.appendChild(o); });

    if(day==="weekday") {
        document.getElementById("workedBox").classList.add("hide");
        document.getElementById("outBox").classList.remove("hide");
    } else {
        document.getElementById("workedBox").classList.remove("hide");
        if(worked==="no") document.getElementById("outBox").classList.add("hide");
        else document.getElementById("outBox").classList.remove("hide");
    }
}

function saveEntry(){
    let date = document.getElementById("inputDate").value;
    let day = document.getElementById("dayType").value;
    if(entries.find(e=>e.date===date)) return alert("Data for this date already exists!");

    let outVal = document.getElementById("outTime").value || "5:30 PM";
    let workedVal = (day==="weekday") ? "yes" : document.getElementById("worked").value;
    let normalOt = 0, nightOt = 0, basicHrs = 0;

    if(day === "weekday") {
        basicHrs = 8;
        let outMins = timeToMins(outVal);
        normalOt = Math.max(0, (Math.min(outMins, 1320) - 1050) / 60);
        nightOt = Math.max(0, (outMins - 1320) / 60);
    } else {
        if(day === "sunday") basicHrs = 8;
        if(workedVal === "yes") {
            let outMins = timeToMins(outVal);
            let extraOt = Math.max(0, (Math.min(outMins, 1320) - 1050) / 60);
            normalOt = 8 + extraOt; 
            nightOt = Math.max(0, (outMins - 1320) / 60);
        }
    }

    entries.push({ date, day, worked:workedVal, normalOt, nightOt, basicHrs });
    entries.sort((a,b)=>new Date(b.date)-new Date(a.date));
    localStorage.setItem(STORE_KEY, JSON.stringify(entries));
    renderHistory();
}

function calculateSalary() {
    let rate = parseFloat(document.getElementById("hourlyRate").value) || 0;
    let totalPay = 0;
    entries.forEach(e => {
        let dayPay = (e.basicHrs * rate); 
        if (e.worked === "yes") dayPay += (e.normalOt * rate * 1.5) + (e.nightOt * rate * 3.0);
        totalPay += dayPay;
    });
    document.getElementById("finalSalary").innerText = Math.round(totalPay).toLocaleString();
}

function exportToExcel() {
    if(entries.length === 0) return alert("No data to export!");
    let csv = "Date,Day Type,Basic Hours,OT Hours,Night Hours,Status\n";
    entries.forEach(e => {
        csv += `${e.date},${e.day},${e.basicHrs},${e.normalOt},${e.nightOt},${e.worked}\n`;
    });
    let blob = new Blob([csv], { type: 'text/csv' });
    let url = window.URL.createObjectURL(blob);
    let a = document.createElement('a');
    a.href = url;
    a.download = `Ronnie_Salary_Report_${new Date().toISOString().slice(0,7)}.csv`;
    a.click();
}

function renderHistory(){
    let body=document.getElementById("historyBody");
    body.innerHTML="";
    let wB=0, nOT=0, niOT=0, sD=0, suD=0, hD=0;

    entries.forEach((e,i)=>{
        if(e.day==="weekday") wB += e.basicHrs;
        if(e.worked==="yes"){
            if(e.day==="saturday") sD++;
            else if(e.day==="sunday") suD++;
            else if(e.day==="holiday") hD++;
        }
        nOT += e.normalOt; niOT += e.nightOt;

        let tr=document.createElement("tr");
        if(e.day !== 'weekday') tr.className = "row-weekend";
        tr.innerHTML=`<td>${e.date.slice(5)}</td>
                      <td class="${e.day!=='weekday'?'red-text':''}">${e.day.toUpperCase()}</td>
                      <td>${e.basicHrs}</td>
                      <td style="font-weight:bold; color:${(e.normalOt+e.nightOt)>0?'#2962ff':''}">${(e.normalOt+e.nightOt).toFixed(1)}</td>
                      <td><button style="background:none;color:red;font-size:18px;width:auto;margin:0;" onclick="delEntry(${i})">üóëÔ∏è</button></td>`;
        body.appendChild(tr);
    });
    document.getElementById("totalBasicHrs").innerText = wB + " hrs";
    document.getElementById("satStats").innerText = sD + " days";
    document.getElementById("sunStats").innerText = suD + " days";
    document.getElementById("holStats").innerText = hD + " days";
    document.getElementById("totalNormalOt").innerText = nOT.toFixed(1);
    document.getElementById("totalNightOt").innerText = niOT.toFixed(1);
    calculateSalary();
}

function delEntry(i){ if(confirm("Are you sure you want to delete this entry?")){ entries.splice(i,1); localStorage.setItem(STORE_KEY, JSON.stringify(entries)); renderHistory(); } }
function resetAll(){ if(confirm("WARNING: This will delete ALL data for this month. Continue?")){ entries=[]; localStorage.setItem(STORE_KEY,"[]"); renderHistory(); } }

setInitialDate(); renderHistory();
</script>
</body>
</html>
